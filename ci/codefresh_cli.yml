version: '1.0'
steps:
  Unit Tests:
    title: "Run Unit Tests"
    image: node:10-alpine
    working_directory: ./cli
    commands:
      - yarn install 
      - yarn test
  DeployCliToNpm:
    title: "Deploying Cli To NPM"
    image: node:6.10.3-alpine
    working_directory: ./cli
    environment:
      - NPM_TOKEN=${{NPM_TOKEN}}
    commands:
      - echo //registry.npmjs.org/:_authToken=${NPM_TOKEN} > ~/.npmrc
      - npm publish
    when:
      branch:
        only:
          - master
