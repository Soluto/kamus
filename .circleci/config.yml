version: 2
jobs:
  build:
    machine: true

    steps:
      - checkout
      - run:
          name: Build docker image
          working_directory: "init-container"
          command: docker build . -t soluto/kamus-init-container:$CIRCLE_BUILD_NUM

      - run:
          name: Run black box tests
          working_directory: "init-container/tests"
          command: sudo INIT_CONTAINER_IMAGE=soluto/kamus-init-container:$CIRCLE_BUILD_NUM ./run_test.sh

      - run:
          name: Docker push
          working_directory: "init-container/tests"
          command: docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD && docker push soluto/kamus-init-container:$CIRCLE_BUILD_NUM